version: '3.8'

services:
  gcli2api:
    build: .  # <-- 修改这里：使用当前目录的 Dockerfile 来构建镜像
    image: gcli2api:local
    container_name: gcli2api
    restart: unless-stopped
    # network_mode: host  <-- 删除或注释掉这一行
    ports:
      - "7881:7861" 

    environment:
      # 使用通用密码（推荐用于简单部署）
      - PORT=7861
      # 或使用分离密码（推荐用于生产环境）
      - API_PASSWORD=007142
      - PANEL_PASSWORD=031707
      - GOOGLE_API_KEY=AIzaSyDlnckYAADStp9PgmNSBAzkQluLhgQVczI

      # Google Search 配置
      - GOOGLE_Search_CX_ID=4388e067f574f46cb
      # 多个 Key 用英文逗号分隔
      - GOOGLE_Search_API_KEY=AIzaSyBuoTdP6SCeOLRkawFpIf0ikn_G3hEqlEA,AIzaSyBitd-0YQXY-qARymXyH4movfiSJ6LZc6c,AIzaSyBy9SvwvaC_8_MF6EkgwL8rfRm7_c29zv0,AIzaSyC9z_q-eFCqSxZ7ntNrFhmU4O0BSAlEKTY,AIzaSyCbHcTXkDx_NnCmM0G8U3hS_mEgEaHtPv0,AIzaSyBTVRo5kuGb8Y1ChXesIlCY8CdbCWQbRlw,AIzaSyBPiwRUZKJNE9fxx2rK-IwUYUXFzCiNYeQ,AIzaSyCXYYL-LogmEuiz8zbp9Rr4S26FTcTLPtI,AIzaSyA9ETpZ-Pes6B_zYjFnF34L80_5ypEbis4,AIzaSyCf7MI3IUgoCUQL2eElS1nyx-XKfXgu6sY,AIzaSyBVvy9PfaCSQD5gOa3BAJEkvQNmFprrYYI,AIzaSyDYGHjYoXXrtW3cKTbm5xEWf6wYmSJaUyA,AIzaSyBfrVfeYOQnopd33AYdSUKAdWHtvIlP9oQ,AIzaSyC9_Jn_wZwMq9rz9e8ju0sGH_LqfKL-EGI,AIzaSyAtGqbJMRdu9LZ5Dy3ojJoA2KoRQJ0EBLI,AIzaSyB93zjqxzm7E_sYgej06E4cfL-li6x5A6g,AIzaSyDZ8a90-lsAQVQelzGMtpMdVgLxPFq09to,AIzaSyAcJl5HRBLV5YpHG4gfi2y2Vhz5K6JJPuY,AIzaSyBo5SKpTiFjHhvRLGeLFCW090aWEFNsXnE,AIzaSyAKgfxXXmGX7RbJZzg8t3LVdAAYLs6URR4,AIzaSyCR1hwVKMt2A2YaBHUbDnbdUgB9iTNLOiI,AIzaSyCSkg6Gb8XByOY95g9P605sg5eDUuL7rEg,AIzaSyAD157xqO5UFhtbxeuiv_JJNwK07JU0hq8,AIzaSyD_9rL1MNu14ZgQw0-T070Ey0gg9BGswhk,AIzaSyDFCuvEz0Ed2OJHATcyIqg0X13vz3P3t7g,AIzaSyDo3qGwtSHpSYmOmOGXlmGQM-LWXrRCTBQ,AIzaSyDMARbxRZhBx1hd47MVrkRxKC57k0eBaVg,AIzaSyBQgiX6lA7elI06nKJrv9GC-sOOou9XrEQ,AIzaSyCp3lI8pTdDFtllm67EohBIlF8KQTuojGo,AIzaSyDHp6YczPZX6_9J1W_11GXKnV6Y64KIeQI,AIzaSyDZmrUOS-_1acUMjz3oT5c77TIeYNXMYxs,AIzaSyDCfuXS0CIOcygB3L2JLUd_UiDRNtF8QTo,AIzaSyCa6cZQd3Q8T4JV2TvVOHOF0gjOsWvGQ20,AIzaSyCvwkAYhiDwtO-cFAUBTnqKDhgRU5eBliE,AIzaSyBFFGQLcjjfxksGjHq_y33Htzhn1EDU06g,AIzaSyCd3FMPQmqDW2vQvl_cKBHtC_fZPDh8loc,AIzaSyBvU5FyPnRaBzUYq1L4EV7dPQncYAQ6PAg,AIzaSyADdKVqRuySHh_PD2ru4ZWKyYzFK4tYB6c,AIzaSyC2k1WDAI3MZVj9dhX5fZ2_XS4pZP3bYEk,AIzaSyBN9jXx7_BOOSg2VPZJpfnv28LHbs7bTN0,AIzaSyCFrcO6ekgYx1ikcDw1ksVUo1XaLZwxGCc,AIzaSyC1yWVRMmTQuz9k5DY8nTCQtPV-qXKmSDk,AIzaSyC0LbCgDWX5NFxZNcIPyPS0klmXns7jt0g,AIzaSyBPeGslzPHbYZHkEXXgLO9iydVtNqSyOMw,AIzaSyApmIB9uT-HVeHsJGkAvzDHhntWi9FGzm4,AIzaSyB6FBok8GLkDGELowJ5DJO2yrCXLspeg_4,AIzaSyCDjSpYPyvrI-JnPoI4Z211PBYGgGgOWPo,AIzaSyAaBpq8yr6g0l7VODS-Uc0-qtrP1ebXubY,AIzaSyCliDH28dOMv8cfd4QI-rhV5vk-2FCnkSk,AIzaSyD0kWZ217lyZS8OVPuRUDSDNKb13snMXp0,AIzaSyDnyWmlzDRrkNp83aoNMTDl3zYTop2cNS0,AIzaSyCR03kY31zzRqth__Au9kKipWEUY2AwCsc,AIzaSyCo6CGBXXSAbMVQ8f2ViYZ04agkHrPxxTY,AIzaSyCvqh-ogy_8E2oGLuvkw-A7BY2M5wqL54Q,AIzaSyDoVWlFNEQ3r6PJA6eTqK5XWxcaSSZaWSQ,AIzaSyAZgX_HOxVMLqWckMuM9maKuFQ3oF6LZHY,AIzaSyC4WCQX7vkvCwdbwBqlvTwmE7JTHpwAuWM,AIzaSyBh5UatgMYPOltNLMJV2rNyb1JnkHqNkgs,AIzaSyDZcXAJ7U5GYQueD0mpN20M39uDstf0sFo,AIzaSyALMc4WqHZjLOTNZAsVlgCmsDHMDn2ttD8,AIzaSyApd9mMoxV2J3H7VAdEVpylGuU-J1cq78k,AIzaSyBUNIQSO71eYcr7cqIpBo1i61bPZPRQkWg,AIzaSyBe_Njhm32odapXbYMsrMO3tzsX72zdANg,AIzaSyDJ75gnij3ufvsFzBadUKZIwjCqUPObjBA,AIzaSyCgHPfHhAvi0F5arKN7r101qLZgy2FnSfI,AIzaSyDsujudQv7VygmALzHOILgxNbDXDIhM-EU,AIzaSyDRBeZGZLA_U0G0zB01s5mFtLi2PCUUwJI,AIzaSyB_YniYIRXiXVW-vhkFLR75dwe49Q-AfGM,AIzaSyBH85DxltoMyhtxi5z53EmMxiQVuj1dNBQ,AIzaSyCkxpDoRZ9nhhij2SND6ahFHllhSNTAvqY,AIzaSyCMm9uTgJ3V12SGktJzJBgh1ERp77reBqQ,AIzaSyBxYWokwp-4HHU0e61WqmOg34NGSMCi5q8,AIzaSyDlnckYAADStp9PgmNSBAzkQluLhgQVczI,AIzaSyDkmWhhq_3WQdE65zpPHJwq7Gur50U22EA
      
    volumes:
      - ./data/creds:/app/creds
    healthcheck:
      test: ["CMD-SHELL", "python -c \"import sys, urllib.request, os; port = os.environ.get('PORT', '7861'); req = urllib.request.Request(f'http://localhost:{port}/v1/models', headers={'Authorization': 'Bearer ' + os.environ.get('PASSWORD', 'pwd')}); sys.exit(0 if urllib.request.urlopen(req, timeout=5).getcode() == 200 else 1)\""]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s